---
title: 计算机网络基础知识
original: true
date: 2020-10-31
updated: 
tags: 
  - Network
  - Note
urlname: basic-computer-network
---
记录计算机网络学习的笔记. 
<!--more-->
# 1. 计算机网络和因特网

互联网是一个连接了全世界数以亿计的计算设备的网络. 以前这些计算设备通常是传统的桌面PC, Linux工作站或者说是服务器(用于提供存储传输Web页面和电子邮件等信息). 而现在越来越多非传统的因特网设备和因特网相连(如手机, 平板, 相机, 汽车等). 所有这些设备都成为主机(host)或端系统(end system). 

![](/picture/2020-10-31-17-32-02.png)

端系统通过通信链路(communication link)和分组交换机(packet switch)连接到一起. 
- 通讯链路: 可能是同轴电缆, 铜线, 光纤等, 不同链路提供不同的速率. 
- 分组交换机: 可能是路由器(router), 链路交换机(link-layer switch)等. 

当一台端系统向另一台端系统发送数据时, 发送端会把数据分段, 为每段加上首部字节, 形成数据包分组(packet, 也叫数据包), 然后分组交换机就负责将这些分组, 向着它们需要到达的地方转发传输. 

## 1.1 网络的核心部分

在应用层中, 端系统之间彼此交换的是**报文**(message), 报文中包含协议设计者需要的任何东西. 可以理解成不同的内容, 比如可以执行的内容, 也可以是数据(电子邮件数据, JPEG图像或者是音频等). 为了能移动这些报文(也就是数据), 通过网络链路和交换机来实现有两种基本方法. 
- 分组交换(packet switching)
- 电路交换(circuit switching)

下面就只讲用得比较多的的分组交换: 

### 1.1.1 分组交换

分组交换会将长报文划分为较小的数据块, 称之为**分组**(packet). 多数分组交换机在链路的输入端采用**存储转发传输机制**(store-and-forward transmission). 简单来说就是分组交换机在转发一个分组之前, 需要从上游接收并缓存整个分组. 对于每个分组交换机, 它有多条输出链路, 也就是转发到下一跳, 对于每条输出链路分组交换机会有一个**输出缓存**(output buffer) (也叫**输出队列**output queue). 

![](/picture/2020-10-31-19-58-42.png)

缓存队列是在路由器内的, 图中为了展示它所以画在了外面. 图中蓝色小方块为一个分组(packet), 红色的为丢失的分组. 
如果到达的分组需要传输到某条链路, 但发现链路正忙于传输其他分组, 那么到达分组需要在输出缓存中等待, 如果缓存满了那么就会出现分组丢失(**丢包**, 也就是图中红色的小方块). 到达的分组或者排队中的分组之一会被丢弃. 
因此数据传输过程中除了**存储转发时延**以外, 分组还要承受输出缓存的**排队时延**(queue delay). 

那路由器是怎么知道分组要转发给哪个路由呢? 

不同计算机网络是使用不同的方式完成的, 下面就简要说一下因特网中采用的方法. 
在因特网中每个端系统具有一个**IP地址**, 报文划分为分组时, 分组的首部就包含了目的地的IP地址. 当一个分组到达网络中的路由器时, 路由器会检查该分组的目的地址, 将该地址与路由器自身维护的**转发表**(forwarding table)对照查询, 查询到适当的输出链路, 那么路由器就会将该分组导向该出链路. 
至于转发表是怎么来的, 作者说后面再说. 总之因特网具有一些特殊的**路由选择协议**(routing protocol)用于自动设置这些转发表. 

## 1.2 分组交换的时延

分组从一个结点沿路到后继节点过程中, 它在每个结点都经受了几种不同类型的时延. 其中最重要的为: 
- 结点处理时延(nodal processing delay): 检查比特级别的差错需要的时间, 检查首部以及决定将该分组导向何处需要的时间. 
- 排队时延(queuing delay): 取决于先到达的正在排队的分组数量. 
- 传输时延(transmission delay): 取决于分组的长度以及链路的传输速率. 
- 传播时延(propagation delay): 取决于链路的物理媒体(光纤, 双绞铜线等). 也与链路的长度有关. 

# 2. 体系结构

##  2.1 结构模型

首先是OSI和TCP/IP的分层模型和对应关系: 

![](/picture/2020-10-30-23-59-13.png)

OSI参考模型一共分7层, 一般用于教学, 实际使用更多的是TCP/IP的5层模型. 5层体系模型为: 
- **应用层**: 网络应用程序以及他们的应用层协议留存的地方. (如: HTTP提供Web文档请求和传送; SMTP提供电子邮件报文的传输; FTP提供两个端系统间文件传送; DNS域名解析系统等) 位于应用层的信息分组称为**报文**(message). 
- **运输层**: 因特网的运输层在应用程序端点之间传送应用层报文. 因特网中有TCP和UDP这两种协议. TCP向应用程序提供了面向连接的服务, 包括应用层报文确保传递和流量控制机制, 会将长报文划分为短报文, 并提供拥塞控制机制. UDP面向无连接, 上面TCP有的它没有. 位于运输层的分组称为**报文段**(segment). 
- **网络层**: 负责将称为**数据报**(datagram)的网络分组从一台主机移动到另一台. 上一层运输层会给网络层提供 报文段 和 目的地址 . 这一层包括著名的IP协议与许多路由选择协议, 但通常也会被称为IP层. 
- **链路层**: 链路层负责将数据报传递给下一个结点. 它提供的服务取决于应用于该链路层的特定链路协议. 比如某些协议基于链路提供可靠传递, 但是这种可靠传递不同于TCP的端系统对端系统的可靠交付, 而是包括以太网, WiFi和电缆接入网的DOCSIS协议. 因为数据报从源到目的地传送通常需要经过几条链路, 所以一个数据报可能被沿途不同链路上的不同链路层协议处理. 链路层的分组称为**帧**(frame). 
- **物理层**: 物理层的任务是将帧中的一个个**比特**从一个结点移动到下一结点. 这一层中的协议仍是链路相关的, 并且进一步与该层链路(例如: 双绞铜线, 单模光纤)的实际传输媒体相关. 比如: 以太网就有许多物理层协议, 有基于双绞铜线的, 有基于同轴电缆的, 还有基于光纤的... 在每种场合, 跨越这些链路移动一个比特是以不同的方式进行的. 

作者举的快递的例子非常容易理解: 我们在网上买东西, 首先确定自己所在的位置有相应的快递网点, 这个网点就相当于网络接入层, 然后需要告诉卖家地址, 这个地址相当网际互联层, 快递送货相当于传输层, 最后我们收到货物之后拆包使用相当于应用层. 
而在BS结构中, TCP/IP模型中的网络接入层没有相应协议, 网际互联层是IP协议, 传输层是TCP协议. 

我们来看一下这套结构模型在实际中是怎么运作的: 

![](/picture/2020-10-31-13-05-39.png)

可以看到用户A发送的数据, 经过一层一层**封装**(encapsulation)后发送到用户B的电脑, 然后再一层一层的拆开, 最终用户B得到用户A发送的消息, 这就是模型基本运作的样子. 

## 2.2. 协议

### 2.2.1 IP协议

这里说的IP协议是指Internet Protocol互联网协议, 而我们日常说得IP其实是指IP地址, 也就是一段数字. 在上面快递的例子中, IP地址相当于快递所在网点的地址, 那么在计算机网络中也是一样的, 接入互联网的设备每一台都会有一个IP地址. 在我们日常生活中, 家里办了宽带, 我们的设备能上网, 而那个宽带就包含运营商给我们提供的IP地址, 有了IP地址我们才能和互联网上其他设备进行通讯. 

### 2.2.1 DNS协议

接入到网络的计算机都会有一个IP, 有的计算机是专门给其他计算机提供服务的, 也叫服务器, 所以服务器肯定有自己的IP, 但是用户直接通过IP来访问对应服务器是不大方便的, 所以就有了域名, 而DNS协议的作用就是将域名解析成IP, 但是域名对应的IP经常在变化, 所以就需要专门将域名解析成IP的DNS服务器. 我们直接访问的DNS服务器叫本地DNS服务器, 它本身没有域名和IP对应关系, 在我们发出请求时它会从主DNS服务器获取然后保存到缓存中. 

### 2.2.2 TCP/IP协议

TCP协议和IP协议是两个不同的协议, TCP协议用来规范传输规则, 而IP协议只是负责找到地址. TCP协议在传输前会进行"三次握手", 传输完数据断开时要进行"四次挥手". 

### 2.2.3 TCP协议

TCP协议是一套规则, 如果两台计算机都遵循这个规则, 那么它们之间就可以建立一种可靠的连接, 这种可靠的连接是连接双方都遵循这个TCP协议才能建立的, 而遵守这套协议能够保证我们双方发送和接收到的消息有序且完整.  
协议的特点: 
- 面向连接, 可靠的字节流服务
- 一个TCP连接中只有两方进行通信, 广播和多播不能用于TCP
- 使用校验和, 确认和重传机制来保证可靠的传输
- 数据分节排序, 使用累积确认保证数据顺序不变和非重复
- 使用滑动窗口机制实现流量控制, 通过动态改变窗口大小进行拥塞控制 
- TCP也不是100%可靠的协议, 如果有可能就把数据送到接收方, 否则就放弃重传中断连接通知用户. 

如何建立TCP连接? 

现在计算机双方都知道我需要遵循TCP协议这个规则, 我就能跟其他也遵循这个规则的计算机通讯了, 但是我如何跟另外的TA建立连接呢? 



### 2.2.4 IP协议





参考: 
- 书籍: 计算机网络-自顶向下方法
- 书籍: 看透Spring_MVC：源代码分析与实践
- [一文彻底搞懂 TCP三次握手、四次挥手过程及原理 ](https://juejin.im/post/6844904070000410631)
- [为什么 TCP 建立连接需要三次握手](https://draveness.me/whys-the-design-tcp-three-way-handshake/)
- [TCP协议 笔试面试知识整理](https://hit-alibaba.github.io/interview/basic/network/TCP.html)